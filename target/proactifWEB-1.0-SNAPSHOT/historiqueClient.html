<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Historique</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://code.jquery.com/jquery-3.3.1.min.js">  </script>
    </head>
    <body>
        <h1> Historique </h1>
        <button id="deconnexion">Déconnexion</button>
        <button id="retourPortail">Retour au portail<a href="./portailClient.html"></a></button>
        <div id="filtre">
            <h2>Filtrer intervention</h2>
            <input name="statut" type="radio" id="enCours">En cours
            <input name="statut" type="radio" id="cloturee">Cloturée
            <input type="checkbox" id="annee">Année
             <select name="birth-year" id="choixAnnee">
                <option value="2008">2018</option>
                <option value="2007">2017</option>
                <option value="2006">2016</option>
                <option value="2005">2015</option>
                <option value="2004">2014</option>
                <option value="2013">2013</option>
                <option value="2012">2012</option>
                <option value="2011">2011</option>
                <option value="2010">2010</option>
                <option value="2009">2009</option>
                <option value="2008">2008</option>
                <option value="2007">2007</option>
                <option value="2006">2006</option>
                <option value="2005">2005</option>
                <option value="2004">2004</option>
                <option value="2003">2003</option>
                <option value="2002">2002</option>
                <option value="2001">2001</option>
                <option value="2000">2000</option>
                <option value="1999">1999</option>
                <option value="1998">1998</option>
                <option value="1997">1997</option>
                <option value="1996">1996</option>
                <option value="1995">1995</option>
            </select>
            <input type="radio" name="type" id="selectType">
            <select id="choixType">
                <option value="Animal">Animal</option>
                <option value="Incident">Incident</option>
                <option value="Livraison">Livraison</option>
            </select>
            <button id="bouton-filtrer">Filtrer</button>
        </div>
        
        <table id="liste-interventions">
            <thead>
            <th>Date de la demande</th>
            <th>Type</th>
            <th>Etat</th>
            <th>Type d'animal</th>
            <th>Entreprise</th>
            <th>Type d'objet</th>
            </thead>
            <tbody id="historique"/>
        </table>
        <div>
            <label for="description">Description</label>
            <div id='description'></div>
        </div>
        <div>
            <label for="commentaire">Commentaire</label>
            <div id='commentaire'/></div>
    </div>
        <script type="text/javascript">
            console.log("test page1");
            function ajouter(intervention){
                $("#historique").append(
                    "<tr>"+
                        "<td>"+intervention.date+"</td>"+
                        "<td>"+intervention.type+"</td>"+
                        "<td>"+intervention.typeAnimal+"</td>"+
                        "<td>"+intervention.entreprise+"</td>"+
                        "<td>"+intervention.typeObjet+"</td>"+
                    "</tr>"
                )
            }
            
            function triTypeIntervention(listeIntervention, typeIntervention){
                var listeFiltree=listeIntervention;
                for (var i in listeIntervention) {
                    if (i.type !== typeIntervention){
                        listeFiltree.pop(i);
                    }
                }
                return listeFiltree;
            }
            
            function triAnneeIntervention(listeIntervention, annee){
                var listeFiltree=listeIntervention;
                for (var i in listeIntervention){
                    if (i.annee !== annee){
                        listeFiltree.pop(i);
                    }
                }
                return listeFiltree;
            }
            
            function triStatutIntervention(listeIntervention, statut){
                var listeFiltree=listeIntervention;
                for (var i in listeIntervention){
                    if (i.statut !== statut){
                        listeFiltree.pop(i);
                    }
                }
                return listeFiltree;
            }
            
            function triIntervention(){
                console.log("fonction triIntervention");
                var typeIntervention;
                var annee;
                var statut;
                $('#bouton-filtrer').on('click',function() {
                   console.log("filtrage");
                   if ($('#selectType').attr('checked')){
                       typeIntervention = $('#choixType option:selected').text();
                   }
                   if ($('#annee').attr('checked')){
                       annee = $('#choixAnnee option:selected').text();
                   }
                   if ($("input[name='gender']:checked").val())
                       statut = $("input[name='gender']:checked").val()
                })
                
                //Filtrage
                var listeFiltree=listeIntervention;
                if (annee){
                    listeFiltree=triStatutIntervention(listeFiltree, option[annee]);
                }
                if(statut){
                    listeFiltree=triTypeIntervention(listeFiltree, option.valeur);
                }
                if(typeIntervention){
                    listeFiltree=triAnneeIntervention(listeFiltree,option.valeur);             
                }
                
                //Affichage actualisé
                $('#liste-interventions').empty()
                for (var i in listeFiltree) {
                    ajouter(i);
                }
            }
            
            $(document).ready(function(){
                console.log("entré avant ajax");
                $.ajax({
                    url: './ActionServlet',
                    method: 'POST',
                    data: {
                      action: 'consulterInterventions'
          
                    },
                    dataType: 'json'
                }).done(function(data) {
                    console.log("ok1");
                    
                    $('#liste-interventions').empty();
                    var interventions = data.container;
                    /*var interventions = {
                        {
                            "date":2015,
                            "annee"
                        }
                    }*/
                    for (var i in interventions) {
                        ajouter(i);
                    }
                    console.log("Appel fonctionTri");
                    triIntervention();
                    return false;
                });
            })
            console.log("fin page]");
            
        </script>
    </body>
</html>